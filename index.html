<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>éºµåŒ…åº—å·¥æ™‚çµ±è¨ˆ</title>
<style>
    /* å…¨åŸŸè¨­å®šï¼šé˜²æ­¢å¯¬åº¦è¨ˆç®—å‡ºéŒ¯ */
    * { box-sizing: border-box; }

    body { 
        font-family: "Microsoft JhengHei", Arial, sans-serif; 
        padding: 20px; 
        background-color: #fcfcfc;
        max-width: 1100px;
        margin: 0 auto;
    }

    h2 { color: #333; border-left: 5px solid #5a9bd4; padding-left: 10px; }

    /* æ§åˆ¶åˆ—æ¨£å¼ */
    .controls { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 8px; shadow: 0 2px 5px rgba(0,0,0,0.05); }
    select, button { padding: 5px 10px; cursor: pointer; border-radius: 4px; border: 1px solid #ccc; }
    button { background: #fff; transition: 0.2s; }
    button:hover { background: #f0f0f0; }

    /* ç´€éŒ„åˆ—è¡¨æ¨£å¼ */
    .row { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        margin-bottom: 8px; 
        flex-wrap: wrap; 
        background: #fff;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #eee;
    }
    .hours { font-size: 13px; font-weight: bold; color: #5555aa; min-width: 60px; text-align: center; }

    /* çµ±è¨ˆå€å¡Š */
    .summary { 
        margin-top: 25px; 
        padding: 15px; 
        background: #fdfdfd; 
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px; 
        line-height: 1.6;
    }
    .summary h3 { font-size: 16px; margin: 0 0 10px 0; color: #444; }

    /* æœˆæ›†çµæ§‹ */
    .calendar-container { margin-top: 30px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }
    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        margin-bottom: 5px;
    }
    .weekday {
        text-align: center;
        background: #5a9bd4;
        color: white;
        padding: 5px 0;
        border-radius: 4px;
        font-size: 14px;
    }

    /* æ—¥æ›†æ ¼å­ */
    .calendar .day {
        border: 1px solid #eee;
        min-height: 85px;
        position: relative;
        padding: 5px;
        background: #fff;
        border-radius: 4px;
    }
    .day:hover { background: #fafafa; }
    .day .date-num {
        font-weight: bold;
        font-size: 12px;
        color: #888;
        margin-bottom: 4px;
    }

    /* ç­åˆ¥å°æ¢ */
    .day .shift {
        font-size: 11px;
        padding: 2px 4px;
        margin-top: 2px;
        border-radius: 3px;
        color: #fff;
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    /* æ ¹æ“šå“¡å·¥åç¨±è‡ªå‹•é…è‰² (å°æ‡‰ä½ çš„ shift.A/B/C) */
    .shift.A { background:#5a9bd4; border-left: 3px solid #3d7fb8; } 
    .shift.B { background:#70ad47; border-left: 3px solid #5a8c39; } 
    .shift.C { background:#e06666; border-left: 3px solid #c04444; }
</style>
</head>
<body>

<h2>ğŸ éºµåŒ…åº—å·¥æ™‚çµ±è¨ˆ</h2>

<div class="controls">
    æœˆä»½ï¼š<select id="monthSelect" onchange="render()"></select>
    <button onclick="addRecord()" style="background:#e3f2fd; border-color:#2196f3;">â• æ–°å¢ç´€éŒ„</button>
    <button onclick="exportRecords()">ğŸ’¾ åŒ¯å‡ºå­˜æª”</button>
    <input type="file" id="importFile" style="display:none" onchange="importRecords(event)">
    <button onclick="document.getElementById('importFile').click()">ğŸ“‚ åŒ¯å…¥æª”æ¡ˆ</button>
</div>

<div id="records"></div>

<div class="summary">
    <h3>ğŸ“Š æœ¬æœˆçµ±è¨ˆ</h3>
    <div id="summary"></div>
</div>

<div class="calendar-container">
    <h3>ğŸ—“ï¸ æœˆä»½æ—¥æ›†</h3>
    <div class="calendar-header">
        <div class="weekday">æ—¥</div><div class="weekday">ä¸€</div><div class="weekday">äºŒ</div>
        <div class="weekday">ä¸‰</div><div class="weekday">å››</div><div class="weekday">äº”</div>
        <div class="weekday">å…­</div>
    </div>
    <div class="calendar" id="calendar"></div>
</div>

<script>
// ====== å“¡å·¥è¨­å®š ======
let employees = [
    { name: "A", wage: 190 },
    { name: "B", wage: 190 },
    { name: "C", wage: 190 }
];

// ====== è³‡æ–™ ======
let records = JSON.parse(localStorage.getItem("workRecords")) || [];

// ====== åˆå§‹åŒ–æœˆä»½ ======
function initMonths() {
    const select = document.getElementById("monthSelect");
    const now = new Date();
    const year = now.getFullYear();

    for(let m=1; m<=12; m++){
        let monthStr = `${year}-${String(m).padStart(2,"0")}`;
        let option = document.createElement("option");
        option.value = monthStr;
        option.text = monthStr;
        select.appendChild(option);
    }
    select.value = `${year}-${String(now.getMonth()+1).padStart(2,"0")}`;
}

// ====== å·¥å…·å‡½å¼ ======
function save(){ localStorage.setItem("workRecords", JSON.stringify(records)); }
function generateDays(selected){ 
    let html=""; 
    for(let i=1;i<=31;i++){ html+=`<option value="${i}" ${i==selected?"selected":""}>${i}æ—¥</option>`;} 
    return html; 
}
function generateHours(selected){ 
    let html=""; 
    for(let i=0;i<24;i++){ 
        let h=String(i).padStart(2,"0")+":00"; 
        html+=`<option value="${h}" ${h==selected?"selected":""}>${h}</option>`;
    } 
    return html; 
}
function calculateHours(start,end){ 
    if(!start||!end) return 0; 
    let s=parseInt(start.split(":")[0]); 
    let e=parseInt(end.split(":")[0]); 
    let diff=e-s; 
    if(diff<0) diff+=24; 
    return diff; 
}

// ====== ç´€éŒ„æ“ä½œ ======
function addRecord(){
    records.push({ month: document.getElementById("monthSelect").value, name: employees[0].name, day: 1, start: "14:00", end: "17:00" });
    save();
    render();
}

function update(index,field,value){ records[index][field]=value; save(); render(); }
function setMorning(index){ records[index].start="12:00"; records[index].end="17:00"; save(); render(); }
function setAfternoon(index){ records[index].start="14:00"; records[index].end="17:00"; save(); render(); }
function setEvening(index){ records[index].start="17:00"; records[index].end="21:00"; save(); render(); }
function setFullDay(index){ records[index].start="12:00"; records[index].end="21:00"; save(); render(); }
function removeRecord(index){ if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){records.splice(index,1); save(); render();} }

// ====== åŒ¯å‡ºå…¥ ======
function exportRecords(){
    const dataStr = JSON.stringify(records, null, 2);
    const blob = new Blob([dataStr], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "bakery_records.json"; a.click();
    URL.revokeObjectURL(url);
}

function importRecords(event){
    const file = event.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(e){
        try{
            const imported = JSON.parse(e.target.result);
            if(Array.isArray(imported)){
                let added = 0;
                imported.forEach(r=>{
                    const exists = records.some(rec=>rec.month===r.month && rec.day===r.day && rec.name===r.name && rec.start===r.start && rec.end===r.end);
                    if(!exists){ records.push(r); added++; }
                });
                save(); render(); alert(`åŒ¯å…¥å®Œæˆï¼æ–°å¢ ${added} ç­†è³‡æ–™`);
            }
        } catch(err){ alert("åŒ¯å…¥å¤±æ•—ï¼"); }
    };
    reader.readAsText(file);
}

// ====== ç•«é¢æ›´æ–° ======
function render(){
    const container=document.getElementById("records");
    const summaryDiv=document.getElementById("summary");
    const calendarDiv=document.getElementById("calendar");
    container.innerHTML=""; summaryDiv.innerHTML=""; calendarDiv.innerHTML="";

    const currentMonth=document.getElementById("monthSelect").value;
    const [year,month]=currentMonth.split("-").map(Number);
    let monthRecords=records.filter(r=>r.month===currentMonth);

    // åˆ—è¡¨æ¸²æŸ“
    monthRecords.forEach((r,i)=>{
        const globalIndex=records.indexOf(r);
        const hours=calculateHours(r.start,r.end);
        let div=document.createElement("div");
        div.className="row";
        div.innerHTML=`
            <select onchange="update(${globalIndex},'name',this.value)">
                ${employees.map(e=>`<option value="${e.name}" ${e.name===r.name?"selected":""}>${e.name}</option>`).join("")}
            </select>
            <select onchange="update(${globalIndex},'day',this.value)">
                ${generateDays(r.day)}
            </select>
            <select onchange="update(${globalIndex},'start',this.value)">
                ${generateHours(r.start)}
            </select>
            åˆ°
            <select onchange="update(${globalIndex},'end',this.value)">
                ${generateHours(r.end)}
            </select>
            <span class="hours">â±ï¸ ${hours}h</span>
            <button onclick="setMorning(${globalIndex})">æ—©</button>
            <button onclick="setAfternoon(${globalIndex})">ä¸‹</button>
            <button onclick="setEvening(${globalIndex})">æ™š</button>
            <button onclick="setFullDay(${globalIndex})">å…¨</button>
            <button onclick="removeRecord(${globalIndex})" style="color:red; border-color:#ffcccc;">åˆªé™¤</button>
        `;
        container.appendChild(div);
    });

    // çµ±è¨ˆæ¸²æŸ“
    employees.forEach(emp=>{
        let totalHours=0;
        monthRecords.filter(r=>r.name===emp.name).forEach(r=>{ totalHours+=calculateHours(r.start,r.end); });
        let salary=totalHours*emp.wage;
        if(totalHours > 0) {
            summaryDiv.innerHTML+=`<strong>${emp.name}</strong>ï¼š${totalHours} å°æ™‚ ï¼ <span style="color:#d32f2f;">$${salary.toLocaleString()}</span><br>`;
        }
    });

    // æ—¥æ›†æ¸²æŸ“
    const firstDay = new Date(year, month-1, 1).getDay(); 
    let totalDays = new Date(year, month, 0).getDate(); 
    let dayCount = 1;

    for(let i=0; i<6; i++){
        for(let j=0; j<7; j++){
            let dayDiv=document.createElement("div");
            dayDiv.className="day";
            if(i===0 && j<firstDay){
                dayDiv.innerHTML=""; 
            } else if(dayCount<=totalDays){
                dayDiv.innerHTML=`<div class="date-num">${dayCount}</div>`;
                let dayShifts=monthRecords.filter(r=>r.day==dayCount);
                dayShifts.forEach(r=>{
                    let span=document.createElement("div");
                    span.className=`shift ${r.name}`;
                    span.textContent=`${r.name} ${r.start}-${r.end}`;
                    dayDiv.appendChild(span);
                });
                dayCount++;
            } else {
                dayDiv.style.background = "#f9f9f9";
            }
            calendarDiv.appendChild(dayDiv);
        }
        if(dayCount > totalDays) break;
    }
}

initMonths();
render();
</script>
</body>
</html>